<!doctype HTML>
<html>
	<head>
		<link rel="stylesheet" href="style.css" type="text/css">
		<link rel="stylesheet" href="./scripts/bootstrap/css/bootstrap.min.css" type="text/css">
		<link rel="stylesheet" href="./scripts/bootstrap/css/bootstrap-grid.min.css" type="text/css">
		<link rel="stylesheet" href="./scripts/bootstrap/css/bootstrap-reboot.min.css" type="text/css">
		<link rel="stylesheet" media="screen, print" href="//v.fastcdn.co/f/css?family=Lato:100,300,400,700,900,100italic,300italic,400italic,700italic,900italic" type="text/css"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>
	
	<div class="slideshow-container col-12">

		<div class="mySlides ">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="actionLine" align="center"><p>Tunnusta head kolleegi!</p></div>
		  <div class="informationLine" align="center">
		    <div>
			  <p>Oscareid jagatakse kord aastas, aga kuldsüdameid saab jagada ka siis, 
			    kui kiitmise tunne peale tuleb.</p>
			</div>
			<div>
			  <p>Võta 2 minutit, et tunnustada kolleegi kuldsüdamega, edastades sobiva 
			    tiitli tema Facebooki seinale. Valikus on 18 erinevat tiitlit.</p>
		    </div>
		  </div>
		  <div class="photoSection" align="center">
			<img class="inheritDimension" src="./photos/tunnustus_new-01_elegantsem.png" alt="cv.ee Logo" />
		  </div>
		  <div class="buttonDiv">
		    <button id="1" type="button" class="forwardButton">Alustan</button>
		  </div>
		</div>

		<div class="mySlides ">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="stepNumber" align="center">Samm 1/5</div>
		  <div class="actionText" align="center">
		    <p>Vali sobiv kuldsüda 18 erineva tiitli hulgast vajutades noolt paremale või vasakule</p>
		  </div>
		  
		  <div class="templateSection" align="center">
			<div id="carouselSection" class="carousel slide carouselContent inheritDimension carouselSectionFun" data-ride="carousel" data-interval="false">
			  <div class="carousel-inner inheritDimension carousel-fun">
				<div class="carousel-item active inheritDimension">
				  <div class="imageContainer">
				    <img id="tunnustus_new-01_lobusam" class="templateImage" src="./photos/tunnustus_new-01_lobusam.png" alt="picture" class="img-responsive"/>
				  </div>
				</div>
				<div class="carousel-item inheritDimension">
				  <div class="imageContainer">
				    <img id="tunnustus_new-02_lobusam" class="templateImage" src="./photos/tunnustus_new-02_lobusam.png" alt="picture"/>
				  </div>
				</div>
				<div class="carousel-item inheritDimension">
				  <div class="imageContainer">
				    <img id="tunnustus_new-03_lobusam" class="templateImage" src="./photos/tunnustus_new-03_lobusam.png" alt="picture"/>
				  </div>
				</div>
			  </div>
			  <p class="carousel-control-prev fun-control-prev" role="button" data-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="sr-only">Previous</span>
			  </p>
			  <p class="carousel-control-next fun-control-next" href="" role="button" data-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="sr-only">Next</span>
			  </p>
			</div>
		
			<div id="carouselSection" class="carousel slide carouselContent inheritDimension carouselSectionElegant" data-ride="carousel" data-interval="false" style="display: none;">
			  <div class="carousel-inner inheritDimension carousel-elegant">
				<div class="carousel-item active inheritDimension">
				  <div class="imageContainer">
				    <img id="tunnustus_new-01_elegantsem" class="templateImage" src="./photos/tunnustus_new-01_elegantsem.png" alt="picture" class="img-responsive"/>
				  </div>
				</div>
				<div class="carousel-item inheritDimension">
				  <div class="imageContainer">
				    <img id="tunnustus_new-02_elegantsem" class="templateImage" src="./photos/tunnustus_new-02_elegantsem.png" alt="picture"/>
				  </div>
				</div>
				<div class="carousel-item inheritDimension">
				  <div class="imageContainer">
				    <img id="tunnustus_new-03_elegantsem" class="templateImage" src="./photos/tunnustus_new-03_elegantsem.png" alt="picture"/>
				  </div>
				</div>
			  </div>
			  <p class="carousel-control-prev elegant-control-prev" role="button" data-slide="prev">
				<span class="carousel-control-prev-icon" aria-hidden="true"></span>
				<span class="sr-only">Previous</span>
			  </p>
			  <p class="carousel-control-next elegant-control-next" href="" role="button" data-slide="next">
				<span class="carousel-control-next-icon" aria-hidden="true"></span>
				<span class="sr-only">Next</span>
			  </p>
			</div>
		
		  </div>
		  <div class="buttonDivTemplate" align="center">
		    <p>Vajuta allolevale nupule, et valida kas lõbus või elegantne disain</p>
			<div>
		      <button id="funDesign" type="button" class="templateSelection selected">Lõbus disain</button>
			  <button id="elegantDesign" type="button" class="templateSelection">Elegantne disain</button>
			</div>
		  </div>
		  <div class="buttonDiv">
		    <button id="2" type="button" class="forwardButton generateCanvas">Jätkan</button>
		  </div>
		</div>

		<div class="mySlides ">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="stepNumber" align="center">Samm 2/5</div>
		  <div class="actionText" align="center">
			<p>Kirjuta lahtrisse ettevõtte nimi, kus tunnustust vääriv kolleeg töötab
			</p>
		  </div>
		  <div class="contentSection" align="center">
		    <input type="text" class="form-group companyInput borderStyle" maxLength="22" placeholder="Ettevõtte nimi"/>
		    <div class="inheritDimension inputNote">
				<p>PS! Maksimum tähemärkide arv on 22</p>
			</div>
		  </div>
		  <div class="buttonDiv">
			<button id="3" type="button" class="forwardButton addCompanyName">Jätkan</button>
		  </div>
		</div>
		
		<div class="mySlides ">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="stepNumber" align="center">Samm 3/5</div>
		  <div class="actionText" align="center">
			<p>Kirjuta lahtrisse kolleegi nimi, keda soovid kuldsüdamega tunnustad</p>
		  </div>
		  <div class="contentSection" align="center">
		    <input type="text" class="form-group nameInput borderStyle" maxLength="35" placeholder="Ees- ja perekonnanimi"/>
			<div class="inheritDimension inputNote">
				<p>PS! Maksimum tähemärkide arv on 35</p>
			</div>
		  </div>
		  <div class="buttonDiv">
			<button id="4" type="button" class="forwardButton addPersonName">Jätkan</button>
		  </div>
		</div>
		
		<div class="mySlides ">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="stepNumber" align="center">Samm 4/5</div>
		  <div class="actionText" align="center">
			<p>Kirjuta lühidalt lahtrisse, miks su kolleeg on ära teeninud kuldsüdame </p>
		  </div>
		  <div class="contentSection textAreaSection" align="center">		    
			<textarea rows="4" cols="50" class="form-group titleOf textAreaInput borderStyle" maxLength="200"></textarea>
		    <div class="inheritDimension inputNote">
				<p>PS! Maksimum tähemärkide arv on 200</p>
			</div>
		  </div>
		  <div class="actionText" align="center">
		    <p>Kirjuta lahtrisse tunnustaja nimi</p>
		    <input type="text" class="form-group creatorInput borderStyle" maxLength="22" placeholder="Ees- ja perekonnanimi"/>
			<div class="inheritDimension inputNote">
			  <p>PS! Maksimum tähemärkide arv on 22</p>
			</div>
		  </div>
		  <div class="buttonDiv">
			<button id="5" type="button" class="generatePicture forwardButton">Genereerin tunnustuse</button>
		  </div>
		</div>
		
		<div class="mySlides ">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="stepNumber" align="center">Samm 5/5</div>
		  <div class="actionText" align="center">
		    <p>Üllata nüüd enda kolleegi ja
			   postita kuldsüdamega tunnustus
			   tema Facebooki seinale. 
			</p>
		  </div>
		  <div class="photoSection finishSection" align="center">

		  </div>
		  <div class="buttonDiv">
			<button id="shareToFacebook" type="button" class="shareButton">Tunnustan kolleegi</button>
		  </div>
		</div>
		
		<div class="mySlides orderSlide">
		  <div class="slideTitle" align="center">
			<img class="bannerElement" src="./photos/cv_tunnustus_logo-01_new.png" alt="Logo" />
			<!--
			<img class="slideTitleElement companyLogo" src="./photos/cv_logo-01.png" alt="Logo" />
			<p class="slideTitleElement companyElement">CV.ee</p>
			<p class="slideTitleElement activityElement">#tunnustakolleegi</p>
			-->
		  </div>
		  <div class="stepNumber" align="center"></div>
		  <div class="actionText" align="center">
			<p>CV.ee tänab Sind südamest, et leidsid aega
			   tunnustuse valmistegemiseks. 
			</p>
		  </div>
		  <div class="orderPhotoSection orderFinishSection" align="center">
			<img src="" alt="siia_tuleb_pilt" />
		  </div>
		  <div class="actionText" align="center">
			<p>Ja kui soovid ekstra enda kolleegi üllatada,
			   siis telli käega katsutav südamekujuline
			   tunnustus, mille saadame soovitud aadressile! 
			</p>
		  </div>
		  <div class="buttonDiv">
			<button id="sendToPrint" type="button" class="forwardButton addPersonName">Tellin tunnustuse</button>
		  </div>
		</div>
		
	</div>
	
	<br>
		
	<div style="display: none;">
	  <canvas id="templateCanvas"></canvas>
	</div>
			
	<script src="./scripts/jquery-3.2.1.min.js" ></script>
	<script src="./scripts/bootstrap/js/bootstrap.min.js"></script>
	<script>
	$(document).ready(function(){
				
		var selectedDesign = 'funDesign';
		var canvas = document.getElementById('templateCanvas'),
		    ctx = canvas.getContext('2d');
		var background = new Image();	
		
		function saveImageToServer(dataUrl, id){
		  $.ajax({
			type: 'POST',
			url: './scripts/SaveImage.php',
			data: {
			  imgBase: dataUrl
			},
			success: function(data){
				console.log(data);
			  $('.finishSection').append(
			    '<img id="generatedPicture" class="inheritDimension" align="center" src="'+data+'">'
			  );
			}
		  }).done(function(){
		    currentSlide(id+1);
		  });
		}
		
		$('.generatePicture').on('click', function(){
		  var selectedImage;
		  var id = parseInt($(this).attr('id'));
		  
		  switch(selectedDesign){
		    case 'funDesign':
			  var imgElements = $('.carousel-fun').children();
		  
			  imgElements.each(function(i){
				if($(this).hasClass('active')){
				  selectedImage = $(this).find('img');
				} 
			  });
			  break;
			case 'elegantDesign':
			  var imgElements = $('.carousel-elegant').children();
		  
			  imgElements.each(function(i){
				if($(this).hasClass('active')){
				  selectedImage = $(this).find('img');
				} 
			  });
			  console.log(selectedImage);
			  break;
		  }
		  		  
		  var image = new Image();
		  
		  image.onload = function(){
			
			ctx.canvas.width = this.width;
		    ctx.canvas.height = this.height;
		  		  
			console.log(selectedImage);
				  
		    background.src = './photos/tyhi_'+ selectedImage[0]['id'] + '.png';
		    
			background.onload = function(){
		      ctx.drawImage(background,0,0);   
			
			  switch(selectedDesign){
				case 'funDesign':
				  ctx.fillStyle = "#244999";			  
				  ctx.font = "bold 40px arial";
				  ctx.fillText($('.companyInput').val(), 495, 285);
				  ctx.font = "bold 40px arial";
				  ctx.fillText($('.nameInput').val(), 495, 535);  
				  break;
				case 'elegantDesign':
				  ctx.fillStyle = "white";			  
				  ctx.font = "bold 40px arial";
				  ctx.fillText($('.companyInput').val(), 515, 195);
				  ctx.font = "bold 40px arial";
				  ctx.fillText($('.nameInput').val(), 515, 485);
				  break;
			  }
			
			  
		    
			  saveImageToServer(canvas.toDataURL(), id);
			}			
		  };
		  
		  console.log(image);
		  
		  image.src = selectedImage[0]['src'];
		  	
		});
		
		$('.fun-control-prev').on('click', function(){
		  $('.carouselSectionFun').carousel('prev');
		});
		
		$('.fun-control-next').on('click', function(){
		  $('.carouselSectionFun').carousel('next');
		});

		$('.elegant-control-prev').on('click', function(){
		  $('.carouselSectionElegant').carousel('prev');
		});
		
		$('.elegant-control-next').on('click', function(){
		  $('.carouselSectionElegant').carousel('next');
		});
		
		$('.templateImage').on('load', function(){
		  var css;
		  var ratio=$(this).width() / $(this).height();
		  var pratio=$(this).parent().width() / $(this).parent().height();
		  if (ratio<pratio) css={width:'auto', height:'100%'};
		  else css={width:'100%', height:'auto'};
		  console.log(ratio, pratio, css);
		  $(this).css(css);
		});
		
		var slideIndex = 1;
		showSlides(slideIndex);

		function plusSlides(n) {
		  showSlides(slideIndex += n);
		}

		function currentSlide(n) {
		  showSlides(slideIndex = n);
		}

		function showSlides(n) {
		  var i;
		  var slides = document.getElementsByClassName("mySlides");
		  if (n > slides.length) {slideIndex = 1}    
		  if (n < 1) {slideIndex = slides.length}
		  for (i = 0; i < slides.length; i++) {
			slides[i].style.display = "none";  
		  }

		  slides[slideIndex-1].style.display = "block";  

		}
	
	  $('.forwardButton').on('click', function(){
		  var id = parseInt($(this).attr('id'));
		  currentSlide(id+1);
	  });
	  
	  $('.templateSelection').on('click', function(){
		if($(this).attr('id') == 'funDesign'){
		  selectedDesign = 'funDesign';
		  		  
		  $('#funDesign').addClass('selected');
		  $('#elegantDesign').removeClass('selected');
			
		  $('.carouselSectionFun').show();
		  $('.carouselSectionElegant').hide();
		}
		
		if($(this).attr('id') == 'elegantDesign'){
		  selectedDesign = 'elegantDesign';
		  
		  $('#funDesign').removeClass('selected');
		  $('#elegantDesign').addClass('selected');
		  
		  $('.carouselSectionFun').hide();
		  $('.carouselSectionElegant').show();
		}
	  });
	
	  $('#shareToFacebook').on('click', function(){
		var pictureLocation = $('#generatedPicture').attr('src');
	    pictureLocation = window.location+pictureLocation.replace('.', '');
		
		FB.ui({
			method: 'share',
			href: pictureLocation,
		}, function(response){
			if (response && !response.error_message) {
			  currentSlide(7);
			}
		});
	    
	  });
		
	  window.fbAsyncInit = function() {
		FB.init({
		  appId            : '140977083233016',
		  autoLogAppEvents : true,
		  xfbml            : true,
		  version          : 'v2.11'
		});
	  };

	  (function(d, s, id){
		 var js, fjs = d.getElementsByTagName(s)[0];
		 if (d.getElementById(id)) {return;}
		 js = d.createElement(s); js.id = id;
		 js.src = "https://connect.facebook.net/en_US/sdk.js";
		 fjs.parentNode.insertBefore(js, fjs);
	   }(document, 'script', 'facebook-jssdk'));
	});
	</script>

	</body>
</html>